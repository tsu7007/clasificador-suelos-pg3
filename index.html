<!DOCTYPE html>
<html lang=\"es\">
<head>
    <meta charset=\"UTF-8\">
    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">
    <title>Clasificador de Suelos PG-3</title>
    <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>
    <style>
        :root {
            --color-white: rgba(255, 255, 255, 1);
            --color-black: rgba(0, 0, 0, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-brown-600: rgba(94, 82, 64, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-red-500: rgba(192, 21, 47, 1);
            --color-orange-500: rgba(168, 75, 47, 1);
            --color-green-500: rgba(34, 197, 94, 1);
            --color-yellow-500: rgba(234, 179, 8, 1);

            --color-bg-primary: var(--color-cream-50);
            --color-text-primary: var(--color-slate-900);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-border: rgba(94, 82, 64, 0.2);
            --color-surface: rgba(255, 255, 253, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--color-bg-primary);
            color: var(--color-text-primary);
            line-height: 1.6;
        }

        body {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--color-border);
            padding-bottom: 20px;
        }

        h1 {
            font-size: 28px;
            color: var(--color-slate-900);
            margin-bottom: 8px;
        }

        .subtitle {
            color: var(--color-text-secondary);
            font-size: 14px;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .card h2 {
            font-size: 18px;
            margin-bottom: 20px;
            color: var(--color-slate-900);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 18px;
        }

        label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--color-slate-900);
        }

        input[type=\"text\"],
        input[type=\"number\"],
        select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            font-size: 13px;
            background: white;
            color: var(--color-text-primary);
            font-family: inherit;
        }

        input[type=\"text\"]:focus,
        input[type=\"number\"]:focus,
        select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(33, 128, 141, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }

        button {
            flex: 1;
            padding: 12px 16px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
        }

        .btn-secondary {
            background: rgba(94, 82, 64, 0.12);
            color: var(--color-text-primary);
        }

        .btn-secondary:hover {
            background: rgba(94, 82, 64, 0.2);
        }

        .result-box {
            background: linear-gradient(135deg, rgba(33, 128, 141, 0.08), rgba(33, 128, 141, 0.04));
            border-left: 4px solid var(--color-primary);
            padding: 18px;
            border-radius: 6px;
            margin-top: 20px;
            display: none;
        }

        .result-box.visible {
            display: block;
        }

        .result-box h3 {
            font-size: 13px;
            color: var(--color-text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-box .classification {
            font-size: 24px;
            font-weight: bold;
            color: var(--color-primary);
            margin-bottom: 12px;
        }

        .result-box .details {
            font-size: 12px;
            color: var(--color-text-secondary);
            line-height: 1.8;
            background: rgba(255, 255, 255, 0.5);
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }

        .chart-container {
            position: relative;
            width: 100%;
            height: 500px;
            margin-top: 15px;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            background: white;
            padding: 10px;
        }

        .table-wrapper {
            margin-top: 40px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        thead {
            background: rgba(94, 82, 64, 0.08);
        }

        th {
            padding: 12px 8px;
            text-align: left;
            font-weight: 500;
            color: var(--color-slate-900);
            border-bottom: 2px solid var(--color-border);
        }

        td {
            padding: 12px 8px;
            border-bottom: 1px solid var(--color-border);
        }

        tr:hover {
            background: rgba(94, 82, 64, 0.04);
        }

        .action-buttons {
            display: flex;
            gap: 6px;
        }

        .btn-sm {
            padding: 6px 10px;
            font-size: 11px;
            border: 1px solid var(--color-border);
            background: white;
            color: var(--color-text-primary);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-sm:hover {
            background: rgba(94, 82, 64, 0.1);
        }

        .btn-delete {
            color: var(--color-red-500);
        }

        .btn-delete:hover {
            background: rgba(192, 21, 47, 0.08);
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .badge-seleccionado {
            background: rgba(33, 128, 141, 0.15);
            color: var(--color-primary);
        }

        .badge-adecuado {
            background: rgba(34, 197, 94, 0.15);
            color: var(--color-green-500);
        }

        .badge-tolerable {
            background: rgba(234, 179, 8, 0.15);
            color: var(--color-yellow-500);
        }

        .badge-marginal {
            background: rgba(168, 75, 47, 0.15);
            color: var(--color-orange-500);
        }

        .badge-inadecuado {
            background: rgba(192, 21, 47, 0.15);
            color: var(--color-red-500);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--color-text-secondary);
        }

        .empty-state p {
            font-size: 14px;
        }

        .info-text {
            background: rgba(33, 128, 141, 0.05);
            border-left: 3px solid var(--color-primary);
            padding: 12px 15px;
            border-radius: 4px;
            font-size: 12px;
            color: var(--color-text-secondary);
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .sieve-group {
            background: rgba(33, 128, 141, 0.03);
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
        }

        .sieve-grid-5 {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }

        .sieve-label {
            font-size: 11px;
            text-align: center;
            margin-bottom: 4px;
            font-weight: 500;
            color: var(--color-text-primary);
        }

        .criteria-check {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(94, 82, 64, 0.2);
        }

        .criteria-item {
            font-size: 12px;
            padding: 6px 10px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .criteria-pass {
            background: rgba(34, 197, 94, 0.1);
            color: var(--color-green-500);
        }

        .criteria-fail {
            background: rgba(192, 21, 47, 0.1);
            color: var(--color-red-500);
        }

        .check-mark {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <header>
        <h1>‚öôÔ∏è Clasificador de Suelos PG-3</h1>
        <p class=\"subtitle\">Normativa de Carreteras - Sistema Espa√±ol</p>
    </header>

    <div class=\"container\">
        <div class=\"card\">
            <h2>üìã Datos del Suelo</h2>
            <div class=\"info-text\">
                Introduce los par√°metros del suelo seg√∫n la tabla PG-3 oficial.
            </div>

            <form id=\"suelo-form\">
                <div class=\"form-group\">
                    <label for=\"nombre\">Nombre del Suelo</label>
                    <input type=\"text\" id=\"nombre\" placeholder=\"ej: S1, S2, Muestra\" required>
                </div>

                <div class=\"form-group\">
                    <label>Materia Org√°nica</label>
                    <div class=\"form-row\">
                        <div>
                            <label for=\"mo\">MO (%)</label>
                            <input type=\"number\" id=\"mo\" placeholder=\"0\" step=\"0.1\" min=\"0\" required>
                        </div>
                        <div>
                            <label for=\"ss\">SS (%)</label>
                            <input type=\"number\" id=\"ss\" placeholder=\"0\" step=\"0.1\" min=\"0\" required>
                        </div>
                    </div>
                </div>

                <div class=\"form-group\">
                    <label>Propiedades Geot√©cnicas</label>
                    <div class=\"form-row\">
                        <div>
                            <label for=\"hinchamiento\">Hinchamiento (%)</label>
                            <input type=\"number\" id=\"hinchamiento\" placeholder=\"0\" step=\"0.01\" min=\"0\" required>
                        </div>
                        <div>
                            <label for=\"finos\">Finos # 0.080 (%)</label>
                            <input type=\"number\" id=\"finos\" placeholder=\"0\" step=\"0.1\" min=\"0\" required>
                        </div>
                    </div>
                </div>

                <div class=\"form-group\">
                    <label>L√≠mites de Atterberg</label>
                    <div class=\"form-row\">
                        <div>
                            <label for=\"ll\">LL (%)</label>
                            <input type=\"number\" id=\"ll\" placeholder=\"0\" step=\"0.1\" min=\"0\">
                        </div>
                        <div>
                            <label for=\"ip\">IP (%)</label>
                            <input type=\"number\" id=\"ip\" placeholder=\"0\" step=\"0.1\" min=\"0\">
                        </div>
                    </div>
                </div>

                <div class=\"button-group\">
                    <button type=\"submit\" class=\"btn-primary\">Clasificar Suelo</button>
                    <button type=\"reset\" class=\"btn-secondary\">Limpiar</button>
                </div>

                <div id=\"resultado\" class=\"result-box\">
                    <h3>Clasificaci√≥n PG-3</h3>
                    <div class=\"classification\" id=\"classResult\">‚Äî</div>
                    <div class=\"details\" id=\"classDetails\"></div>
                </div>
            </form>
        </div>

        <div class=\"card\">
            <h2>üìä Gr√°fica de Casagrande (PG-3)</h2>
            <p style=\"font-size: 12px; color: var(--color-text-secondary); margin-bottom: 10px;\">
                Clasificaci√≥n seg√∫n l√≠mite l√≠quido (LL) e √≠ndice de plasticidad (IP)
            </p>
            <div class=\"chart-container\">
                <canvas id=\"grafica\"></canvas>
            </div>
            <p style=\"font-size: 11px; color: var(--color-text-secondary); margin-top: 12px; text-align: center;\">
                Punto rojo = Suelo actual | Zonas coloreadas = Clasificaci√≥n PG-3
            </p>
        </div>
    </div>

    <div class=\"table-wrapper\">
        <h2 style=\"margin-bottom: 20px; color: var(--color-slate-900);\">üìà Hist√≥rico de Clasificaciones</h2>
        <div id=\"tabla-container\">
            <div class=\"empty-state\">
                <p>No hay suelos clasificados a√∫n. Introduce los datos y haz clic en \"Clasificar Suelo\".</p>
            </div>
        </div>
    </div>

    <script>
        let suelos = [];
        let chartInstance = null;

        const form = document.getElementById('suelo-form');
        const llInput = document.getElementById('ll');
        const ipInput = document.getElementById('ip');
        const chartCanvas = document.getElementById('grafica');

        function clasificarSuelo(params) {
            const { mo, ss, hinchamiento, finos, ll, ip } = params;

            console.log('DEBUG - Par√°metros recibidos:', params);
            
            // SELECCIONADO
            const seleccionado = mo < 0.2 && ss < 0.2 && hinchamiento < 3 && finos < 25;
            if (seleccionado) {
                console.log('‚úì SELECCIONADO');
                return {
                    clasificacion: 'Seleccionado',
                    criterios: [
                        { condicion: 'MO < 0.2%', cumple: mo < 0.2, valor: `${mo}%` },
                        { condicion: 'SS < 0.2%', cumple: ss < 0.2, valor: `${ss}%` },
                        { condicion: 'Hinchamiento < 3%', cumple: hinchamiento < 3, valor: `${hinchamiento}%` },
                        { condicion: 'Finos < 25%', cumple: finos < 25, valor: `${finos}%` }
                    ]
                };
            }

            // ADECUADO\n            const adecuado = mo < 1 && ss < 0.2 && hinchamiento < 3 && finos < 35;
            if (adecuado) {
                console.log('‚úì ADECUADO');
                return {
                    clasificacion: 'Adecuado',
                    criterios: [
                        { condicion: 'MO < 1%', cumple: mo < 1, valor: `${mo}%` },
                        { condicion: 'SS < 0.2%', cumple: ss < 0.2, valor: `${ss}%` },
                        { condicion: 'Hinchamiento < 3%', cumple: hinchamiento < 3, valor: `${hinchamiento}%` },
                        { condicion: 'Finos < 35%', cumple: finos < 35, valor: `${finos}%` }
                    ]
                };
            }

            // TOLERABLE
            const tolerable = mo < 2 && ss < 1 && hinchamiento < 3;
            if (tolerable) {
                console.log('‚úì TOLERABLE');
                return {
                    clasificacion: 'Tolerable',
                    criterios: [
                        { condicion: 'MO < 2%', cumple: mo < 2, valor: `${mo}%` },
                        { condicion: 'SS < 1%', cumple: ss < 1, valor: `${ss}%` },
                        { condicion: 'Hinchamiento < 3%', cumple: hinchamiento < 3, valor: `${hinchamiento}%` }
                    ]
                };
            }

            // MARGINAL
            const marginal = mo < 5 && ss < 20 && hinchamiento < 5;
            if (marginal) {
                console.log('‚úì MARGINAL');
                return {
                    clasificacion: 'Marginal',
                    criterios: [
                        { condicion: 'MO < 5%', cumple: mo < 5, valor: `${mo}%` },
                        { condicion: 'SS < 20%', cumple: ss < 20, valor: `${ss}%` },
                        { condicion: 'Hinchamiento < 5%', cumple: hinchamiento < 5, valor: `${hinchamiento}%` }
                    ]
                };
            }

            // INADECUADO
            console.log('‚úó INADECUADO');
            return {
                clasificacion: 'Inadecuado',
                criterios: [
                    { condicion: 'No cumple ning√∫n criterio', cumple: false, valor: '‚Äî' }
                ]
            };
        }

        function dibujarGrafica() {
            const ll = parseFloat(llInput.value) || 0;
            const ip = parseFloat(ipInput.value) || 0;

            const lineAPoints = [];
            for (let x = 0; x <= 100; x += 2) {
                lineAPoints.push({ x: x, y: x < 20 ? 0 : 0.73 * (x - 20) });
            }

            const chartConfig = {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'Seleccionados',
                            data: [{x: 0, y: 0}, {x: 25, y: 0}, {x: 25, y: 3}, {x: 0, y: 3}, {x: 0, y: 0}],
                            fill: true,
                            backgroundColor: 'rgba(33, 128, 141, 0.3)',
                            borderColor: 'rgba(33, 128, 141, 0.8)',
                            borderWidth: 2,
                            pointRadius: 0,
                            showLine: true,
                            tension: 0
                        },
                        {
                            label: 'Adecuados',
                            data: [{x: 25, y: 0}, {x: 35, y: 0}, {x: 35, y: 10}, {x: 25, y: 3}, {x: 25, y: 0}],
                            fill: true,
                            backgroundColor: 'rgba(34, 197, 94, 0.3)',
                            borderColor: 'rgba(34, 197, 94, 0.8)',
                            borderWidth: 2,
                            pointRadius: 0,
                            showLine: true,
                            tension: 0
                        },
                        {
                            label: 'Tolerables',
                            data: [{x: 0, y: 0}, {x: 65, y: 0}, {x: 65, y: 32}, {x: 0, y: 0}],
                            fill: true,
                            backgroundColor: 'rgba(234, 179, 8, 0.3)',
                            borderColor: 'rgba(234, 179, 8, 0.8)',
                            borderWidth: 2,
                            pointRadius: 0,
                            showLine: true,
                            tension: 0
                        },
                        {
                            label: 'Marginales',
                            data: [{x: 65, y: 0}, {x: 100, y: 0}, {x: 100, y: 58}, {x: 65, y: 32}, {x: 65, y: 0}],
                            fill: true,
                            backgroundColor: 'rgba(168, 75, 47, 0.3)',
                            borderColor: 'rgba(168, 75, 47, 0.8)',
                            borderWidth: 2,
                            pointRadius: 0,
                            showLine: true,
                            tension: 0
                        },
                        {
                            label: 'L√≠nea A: IP = 0.73(LL - 20)',
                            data: lineAPoints,
                            borderColor: '#000',
                            borderWidth: 3,
                            pointRadius: 0,
                            showLine: true,
                            fill: false,
                            tension: 0
                        },
                        {
                            label: 'Suelo Actual',
                            data: ll > 0 && ip >= 0 ? [{x: ll, y: ip}] : [],
                            pointRadius: 10,
                            pointBackgroundColor: '#d32f2f',
                            pointBorderColor: '#8b0000',
                            pointBorderWidth: 3,
                            showLine: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true, position: 'top', labels: { usePointStyle: true, font: { size: 12, weight: '500' }, padding: 15, color: '#333' } },
                        tooltip: { enabled: true, backgroundColor: 'rgba(0, 0, 0, 0.8)', padding: 10, titleFont: { size: 12, weight: 'bold' }, bodyFont: { size: 11 }, cornerRadius: 4 }
                    },
                    scales: {
                        x: { type: 'linear', position: 'bottom', min: 0, max: 100, ticks: { stepSize: 10, font: { size: 11 }, color: '#666' }, grid: { color: 'rgba(200, 200, 200, 0.2)', drawBorder: true, borderColor: '#333' }, title: { display: true, text: 'LL (%)', font: { size: 13, weight: 'bold' }, color: '#333', padding: 12 } },
                        y: { min: 0, max: 80, ticks: { stepSize: 10, font: { size: 11 }, color: '#666' }, grid: { color: 'rgba(200, 200, 200, 0.2)', drawBorder: true, borderColor: '#333' }, title: { display: true, text: 'IP (%)', font: { size: 13, weight: 'bold' }, color: '#333', padding: 12 } }
                    }
                }
            };

            if (chartInstance) {
                chartInstance.data = chartConfig.data;
                chartInstance.update();
            } else {
                chartInstance = new Chart(chartCanvas, chartConfig);
            }
        }

        form.addEventListener('submit', function(e) {
            e.preventDefault();

            const params = {
                mo: parseFloat(document.getElementById('mo').value) || 0,
                ss: parseFloat(document.getElementById('ss').value) || 0,
                hinchamiento: parseFloat(document.getElementById('hinchamiento').value) || 0,
                finos: parseFloat(document.getElementById('finos').value) || 0,
                ll: parseFloat(llInput.value) || 0,
                ip: parseFloat(ipInput.value) || 0
            };

            const resultado = clasificarSuelo(params);
            const suelo = {
                id: Date.now(),
                nombre: document.getElementById('nombre').value,
                ...params,
                clasificacion: resultado.clasificacion
            };

            suelos.unshift(suelo);

            document.getElementById('classResult').textContent = resultado.clasificacion;
            let detalles = '<div class=\"criteria-check\">';
            resultado.criterios.forEach(c => {
                const clase = c.cumple ? 'criteria-pass' : 'criteria-fail';
                const check = c.cumple ? '‚úì' : '‚úó';
                detalles += `<div class=\"criteria-item ${clase}\"><span class=\"check-mark\">${check}</span> ${c.condicion}: ${c.valor}</div>`;
            });
            detalles += '</div>';
            document.getElementById('classDetails').innerHTML = detalles;
            document.getElementById('resultado').classList.add('visible');

            actualizarTabla();
            dibujarGrafica();
        });

        function actualizarTabla() {
            const container = document.getElementById('tabla-container');
            if (suelos.length === 0) {
                container.innerHTML = '<div class=\"empty-state\"><p>No hay suelos clasificados a√∫n.</p></div>';
                return;
            }

            let html = '<table><thead><tr><th>Nombre</th><th>MO</th><th>SS</th><th>Hinc.</th><th>Finos</th><th>LL</th><th>IP</th><th>Clasificaci√≥n</th><th>Acciones</th></tr></thead><tbody>';

            suelos.forEach(suelo => {
                const badge = `badge-${suelo.clasificacion.toLowerCase()}`;
                html += `<tr><td><strong>${suelo.nombre}</strong></td><td>${suelo.mo}</td><td>${suelo.ss}</td><td>${suelo.hinchamiento}</td><td>${suelo.finos}</td><td>${suelo.ll}</td><td>${suelo.ip}</td><td><span class=\"badge ${badge}\">${suelo.clasificacion}</span></td><td><div class=\"action-buttons\"><button class=\"btn-sm\" onclick=\"copiarSuelo(${suelo.id})\">üìã</button><button class=\"btn-sm\" onclick=\"editarSuelo(${suelo.id})\">‚úèÔ∏è</button><button class=\"btn-sm btn-delete\" onclick=\"eliminarSuelo(${suelo.id})\">üóëÔ∏è</button></div></td></tr>`;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function copiarSuelo(id) {
            const suelo = suelos.find(s => s.id === id);
            if (suelo) {
                document.getElementById('nombre').value = suelo.nombre + ' (copia)';
                document.getElementById('mo').value = suelo.mo;
                document.getElementById('ss').value = suelo.ss;
                document.getElementById('hinchamiento').value = suelo.hinchamiento;
                document.getElementById('finos').value = suelo.finos;
                llInput.value = suelo.ll;
                ipInput.value = suelo.ip;
                dibujarGrafica();
                window.scrollTo({top: 0, behavior: 'smooth'});
            }
        }

        function editarSuelo(id) {
            copiarSuelo(id);
            eliminarSuelo(id);
        }

        function eliminarSuelo(id) {
            suelos = suelos.filter(s => s.id !== id);
            actualizarTabla();
            document.getElementById('resultado').classList.remove('visible');
        }

        dibujarGrafica();
        actualizarTabla();
    </script>
</body>
</html>